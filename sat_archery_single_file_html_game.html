<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>SAT Archery</title>
  <style>
    :root {
      --bg: #0b1220;
      --panel: #121a2b;
      --ink: #e8f0ff;
      --ink-dim: #a9b6d0;
      --accent: #5ee1a2;
      --accent-2: #6ea8ff;
      --danger: #ff6b6b;
      --gold: #ffd166;
    }
    * { box-sizing: border-box }
    html, body { height: 100%; }
    body {
      margin: 0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Noto Sans", "Apple Color Emoji", "Segoe UI Emoji";
      color: var(--ink);
      background: radial-gradient(1100px 500px at 50% -10%, #18243d 0%, var(--bg) 60%);
      display: grid;
      grid-template-rows: auto 1fr auto;
      gap: 10px;
    }
    header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 12px 16px;
      background: linear-gradient(180deg, #0e1730 0, #0b1220 100%);
      border-bottom: 1px solid #1f2a45;
    }
    header h1 { font-size: 18px; margin: 0; letter-spacing: .5px }
    header .controls { display: flex; gap: 8px; align-items: center; }
    button {
      border: 1px solid #273355;
      background: linear-gradient(180deg, #16243f, #0e1830);
      color: var(--ink);
      padding: 10px 14px;
      border-radius: 12px;
      cursor: pointer;
      font-weight: 600;
      letter-spacing: .2px;
      transition: transform .06s ease, box-shadow .15s ease, border-color .15s ease;
      box-shadow: 0 0 0 rgba(0,0,0,0);
    }
    button:hover { transform: translateY(-1px); border-color: #3a4e80; box-shadow: 0 8px 20px rgba(0,0,0,.25); }
    button:active { transform: translateY(0); box-shadow:none }
    button.primary { border-color: #2f7e66; background: linear-gradient(180deg, #195a48, #0f3c31); }
    button.warn { border-color: #6b2b2b; background: linear-gradient(180deg, #5a1d1d, #381414); }

    .hud {
      display: grid;
      grid-template-columns: repeat(5, minmax(0, 1fr));
      gap: 8px;
      padding: 0 16px 8px;
    }
    .card { background: #0f1830aa; border: 1px solid #1f2a45; border-radius: 14px; padding: 10px 12px; }
    .card strong { display:block; color: var(--ink-dim); font-size: 12px; text-transform: uppercase; letter-spacing: .8px; }
    .card span { font-size: 20px; font-weight: 800; }

    main { display: grid; place-items:center; padding: 8px 16px 16px; }

    #gameWrap { position: relative; width: min(100%, 1000px); aspect-ratio: 16 / 9; border-radius: 16px; overflow: hidden; border: 1px solid #1f2a45; box-shadow: 0 25px 60px rgba(0,0,0,.35) }
    canvas { width: 100%; height: 100%; display: block; background: linear-gradient(180deg, #091225 0, #0b1220 35%, #0b1220 100%); }

    .overlay { position: absolute; inset: 0; display: none; align-items: center; justify-content: center; backdrop-filter: blur(2px); background: rgba(10, 15, 30, .6); }
    .overlay.show { display: flex; }

    .panel { background: var(--panel); border: 1px solid #253253; border-radius: 16px; width: min(92%, 700px); padding: 18px; box-shadow: 0 14px 40px rgba(0,0,0,.45) }
    .panel h2 { margin: 2px 0 12px; font-size: 22px; }
    .panel p.note { color: var(--ink-dim); margin-top: 2px; font-size: 13px }

    .choices { display: grid; gap: 10px; margin: 12px 0 6px; }
    .choiceBtn {
      text-align: left; width: 100%; border-radius: 12px; border: 1px solid #273355; padding: 12px 14px; background: linear-gradient(180deg, #15223f, #0f1a34);
      font-weight: 600; line-height: 1.25; letter-spacing: .2px
    }
    .choiceBtn.correct { border-color: #1e7a62; background: linear-gradient(180deg, #1b3f35, #0e2b25); }
    .choiceBtn.wrong { border-color: #7a1e1e; background: linear-gradient(180deg, #3f1b1b, #2b0e0e); }
    .explain { margin-top: 10px; color: var(--ink-dim); font-size: 14px; }

    .bottomRow { display: flex; gap: 8px; justify-content: space-between; align-items: center; margin-top: 12px; }
    .bottomRow .left { display: flex; gap: 8px; }

    footer { padding: 10px 16px; color: var(--ink-dim); font-size: 12px; display:flex; justify-content:space-between; align-items:center }
    .kbd { border: 1px solid #334167; padding: 2px 6px; border-radius: 6px; background: #0e1730; color: var(--ink); font-weight: 700; }

    .toast { position: absolute; left: 50%; top: 14px; transform: translateX(-50%); background: #0e1730; color: var(--ink); padding: 10px 14px; border-radius: 12px; border: 1px solid #2a375e; opacity: 0; transition: opacity .25s ease, transform .25s ease; pointer-events: none; }
    .toast.show { opacity: 1; transform: translateX(-50%) translateY(0); }
  </style>
</head>
<body>
  <header>
    <h1>üèπ SAT Archery</h1>
    <div class="controls">
      <button id="earnBtn" class="primary" title="Answer SAT question to earn arrows">Earn Arrows (SAT)</button>
      <button id="pauseBtn">Pause</button>
      <button id="resetBtn" class="warn">Reset</button>
    </div>
  </header>

  <div class="hud">
    <div class="card"><strong>Arrows</strong><span id="arrows">0</span></div>
    <div class="card"><strong>Score</strong><span id="score">0</span></div>
    <div class="card"><strong>Hits</strong><span id="hits">0</span></div>
    <div class="card"><strong>Best</strong><span id="best">0</span></div>
    <div class="card"><strong>Wind</strong><span id="windHud">0</span></div>
  </div>

  <main>
    <div id="gameWrap">
      <canvas id="game" width="1000" height="562"></canvas>

      <div id="quizOverlay" class="overlay">
        <div class="panel">
          <h2 id="qWord">Word</h2>
          <p class="note">Choose the closest definition.</p>
          <div id="choices" class="choices"></div>
          <div id="explain" class="explain"></div>
          <div class="bottomRow">
            <div class="left">
              <button id="anotherBtn">Another</button>
            </div>
            <div>
              <button id="closeQuiz">Close</button>
            </div>
          </div>
        </div>
      </div>

      <div id="toast" class="toast">+3 arrows</div>
    </div>
  </main>

  <footer>
    <div>
      Hold <span class="kbd">Mouse</span> to draw, release to shoot ‚Ä¢ Aim with the cursor ‚Ä¢ Or use <span class="kbd">Space</span> to draw and <span class="kbd">R</span> to answer a question.
    </div>
    <div>
      Hits on the bullseye award bonus points. Answering correctly grants <strong>+3 arrows</strong>.
    </div>
  </footer>

  <script>
  // ------- Utility helpers -------
  const rand = (a,b)=>Math.random()*(b-a)+a;
  const clamp = (v, a, b)=>Math.max(a, Math.min(b, v));
  const lerp = (a,b,t)=>a+(b-a)*t;

  function shuffle(arr){
    let a = arr.slice();
    for(let i=a.length-1;i>0;i--){
      const j = Math.floor(Math.random()*(i+1));
      [a[i],a[j]]=[a[j],a[i]];
    }
    return a;
  }

  // ------- SAT Questions -------
  const BANK = [
    {w:"abate", d:"to lessen in intensity or amount", x:["to increase rapidly","to argue forcefully","to praise highly"]},
    {w:"aberration", d:"a departure from what is normal or expected", x:["a clever trick","a strong approval","a careful measurement"]},
    {w:"acumen", d:"keen insight; sharpness of mind", x:["physical strength","calm temperament","simple honesty"]},
    {w:"admonish", d:"to warn or reprimand firmly", x:["to celebrate","to ignore","to imitate"]},
    {w:"alacrity", d:"cheerful readiness; eagerness", x:["deep sorrow","extreme anger","calm indifference"]},
    {w:"ambivalent", d:"having mixed feelings or contradictory ideas", x:["completely certain","secretly hostile","easily amused"]},
    {w:"aplomb", d:"self-confidence or assurance, especially in demanding situations", x:["awkwardness","dishonesty","naivete"]},
    {w:"assuage", d:"to make less severe; to ease", x:["to provoke","to measure","to combine"]},
    {w:"cogent", d:"clear, logical, and convincing", x:["unnecessarily complicated","emotionally flat","partially true"]},
    {w:"concur", d:"to agree", x:["to object","to confuse","to postpone"]},
    {w:"deleterious", d:"harmful, often in a subtle way", x:["helpful","obvious","temporary"]},
    {w:"demur", d:"to raise doubts or show reluctance", x:["to agree gladly","to hurry","to spend lavishly"]},
    {w:"didactic", d:"intended to teach, often moral lessons", x:["intended to amuse only","purely decorative","needlessly complex"]},
    {w:"disparate", d:"fundamentally different; distinct", x:["closely related","slightly changed","poorly made"]},
    {w:"ebullient", d:"overflowing with enthusiasm", x:["quietly reflective","bitter and harsh","deeply uncertain"]},
    {w:"equanimity", d:"mental calmness and composure", x:["creative energy","sudden fear","strong opposition"]},
    {w:"eschew", d:"to deliberately avoid or abstain from", x:["to search for","to explain","to celebrate"]},
    {w:"fastidious", d:"very attentive to detail; hard to please", x:["easily distracted","generally kind","open to risk"]},
    {w:"furtive", d:"attempting to avoid notice; secretive", x:["extremely loud","totally honest","highly visible"]},
    {w:"gregarious", d:"sociable; enjoying company", x:["moody","solitary","argumentative"]},
    {w:"harangue", d:"a lengthy and aggressive speech", x:["a gentle reminder","a brief summary","a poetic praise"]},
    {w:"impetuous", d:"acting quickly without thought or care", x:["utterly exhausted","carefully planned","deeply moving"]},
    {w:"inimical", d:"hostile; harmful", x:["friendly","uncertain","ineffective"]},
    {w:"laconic", d:"using very few words", x:["overly emotional","clearly incorrect","pleasantly musical"]},
    {w:"mendacious", d:"not telling the truth; lying", x:["helpful","timid","generous"]},
    {w:"obdurate", d:"stubbornly refusing to change one's opinion", x:["quick to forgive","easy to persuade","eager to learn"]},
    {w:"obviate", d:"to remove a need or difficulty; to prevent", x:["to emphasize","to estimate","to misunderstand"]},
    {w:"parsimony", d:"extreme unwillingness to spend money or resources", x:["careful planning","mild generosity","loud enthusiasm"]},
    {w:"prosaic", d:"dull, lacking in imagination; ordinary", x:["strangely beautiful","highly technical","intensely emotional"]},
    {w:"propitious", d:"favorable; indicating a good chance of success", x:["unlikely","suspicious","equally risky"]},
    {w:"reticent", d:"not revealing one's thoughts readily; reserved", x:["wildly excited","highly talkative","easily persuaded"]},
    {w:"sagacious", d:"wise; having good judgment", x:["famous","quick","stubborn"]},
    {w:"soporific", d:"tending to cause sleep", x:["painful","confusing","energetic"]},
    {w:"spurious", d:"not genuine; false", x:["simple","dangerous","partly true"]},
    {w:"tenable", d:"able to be maintained or defended against attack", x:["likely to collapse","barely visible","open to emotion"]},
    {w:"trenchant", d:"sharp or incisive (style or criticism)", x:["overly polite","poorly timed","hard to hear"]},
    {w:"vacillate", d:"to waver between opinions or actions", x:["to concentrate","to accuse","to simplify"]},
    {w:"verbose", d:"using more words than needed", x:["perfectly silent","very confused","strictly accurate"]},
    {w:"zealous", d:"having or showing great energy and enthusiasm", x:["easily bored","quietly bitter","calmly neutral"]},
  ];

  // ------- Quiz Logic -------
  const earnBtn = document.getElementById('earnBtn');
  const quizOverlay = document.getElementById('quizOverlay');
  const qWord = document.getElementById('qWord');
  const choicesBox = document.getElementById('choices');
  const explain = document.getElementById('explain');
  const closeQuiz = document.getElementById('closeQuiz');
  const anotherBtn = document.getElementById('anotherBtn');
  const toast = document.getElementById('toast');

  let currentQ = null;

  function pickQuestion(){
    currentQ = BANK[Math.floor(Math.random()*BANK.length)];
    qWord.textContent = `Define: ${currentQ.w}`;
    explain.textContent = '';
    const options = shuffle([currentQ.d, ...shuffle(currentQ.x).slice(0,3)]);
    choicesBox.innerHTML = '';
    options.forEach(opt=>{
      const btn = document.createElement('button');
      btn.className = 'choiceBtn';
      btn.textContent = opt;
      btn.onclick = ()=> grade(btn, opt === currentQ.d);
      choicesBox.appendChild(btn);
    });
  }

  function grade(btn, correct){
    [...choicesBox.children].forEach(b=>b.disabled=true);
    if(correct){
      btn.classList.add('correct');
      explain.innerHTML = `<strong>Correct!</strong> +3 arrows.`;
      addArrows(3);
      showToast('+3 arrows');
    } else {
      btn.classList.add('wrong');
      explain.innerHTML = `<strong>Definition:</strong> ${currentQ.d}`;
    }
  }

  function showToast(msg){
    toast.textContent = msg;
    toast.classList.add('show');
    setTimeout(()=>toast.classList.remove('show'), 1200);
  }

  earnBtn.onclick = ()=>{ quizOverlay.classList.add('show'); pickQuestion(); };
  closeQuiz.onclick = ()=> quizOverlay.classList.remove('show');
  anotherBtn.onclick = ()=> pickQuestion();

  // Keyboard shortcuts
  window.addEventListener('keydown', (e)=>{
    if(e.key.toLowerCase()==='r') earnBtn.click();
  });

  // ------- Game State -------
  const cvs = document.getElementById('game');
  const ctx = cvs.getContext('2d');

  let arrows = 0, score = 0, hits = 0;
  let best = +localStorage.getItem('satArcheryBest') || 0;
  const arrowsEl = document.getElementById('arrows');
  const scoreEl = document.getElementById('score');
  const hitsEl = document.getElementById('hits');
  const bestEl = document.getElementById('best');
  const windHud = document.getElementById('windHud');
  bestEl.textContent = best;

  function addArrows(n){ arrows = Math.min(arrows + n, 12); arrowsEl.textContent = arrows; }
  function addScore(n){ score += n; scoreEl.textContent = score; if(score>best){ best=score; bestEl.textContent=best; localStorage.setItem('satArcheryBest', best);} }
  function addHit(){ hits++; hitsEl.textContent = hits; }

  // Wind mechanic: varies slowly, pushes arrows horizontally
  let wind = 0; // px/s^2 (horizontal acceleration)
  let windTarget = 0;
  let windTimer = 0;
  function updateWind(dt){
    windTimer -= dt;
    if(windTimer <= 0){
      windTimer = rand(3, 7);
      windTarget = rand(-18, 18);
    }
    wind = lerp(wind, windTarget, clamp(dt*0.3,0,1));
    windHud.textContent = wind.toFixed(1);
  }

  // Bow properties
  const bow = { x: 80, y: cvs.height - 120, power: 0, drawing: false, aimX: 200, aimY: cvs.height-200 };

  // Target properties (concentric rings)
  const target = { x: cvs.width - 140, y: 160, r: 50, vy: 90, dir: 1 };

  // Arrow projectiles
  const projectiles = [];

  // Input handling (mouse & keyboard)
  let mouse = {x: 0, y: 0};
  cvs.addEventListener('mousemove', (e)=>{
    const rect = cvs.getBoundingClientRect();
    mouse.x = (e.clientX - rect.left) * (cvs.width / rect.width);
    mouse.y = (e.clientY - rect.top) * (cvs.height / rect.height);
    bow.aimX = mouse.x; bow.aimY = mouse.y;
  });

  function startDraw(){
    if(quizOverlay.classList.contains('show')) return;
    bow.drawing = true; bow.power = 0;
  }
  function endDraw(){
    if(!bow.drawing) return;
    bow.drawing = false;
    shoot();
  }

  cvs.addEventListener('mousedown', startDraw);
  window.addEventListener('mouseup', endDraw);

  let spaceHeld = false;
  window.addEventListener('keydown', (e)=>{
    if(e.code==='Space' && !spaceHeld){ spaceHeld=true; startDraw(); e.preventDefault(); }
  });
  window.addEventListener('keyup', (e)=>{
    if(e.code==='Space'){ spaceHeld=false; endDraw(); e.preventDefault(); }
  });

  function shoot(){
    if(arrows<=0){ showToast('No arrows ‚Äî answer a question!'); return; }
    const dx = bow.aimX - bow.x;
    const dy = bow.aimY - bow.y;
    const angle = Math.atan2(dy, dx);
    const pwr = clamp(bow.power, 0.2, 1);
    const speed = lerp(420, 740, pwr);
    projectiles.push({ x: bow.x+24*Math.cos(angle), y: bow.y+24*Math.sin(angle), vx: Math.cos(angle)*speed, vy: Math.sin(angle)*speed, angle, life: 0, stuck:false });
    arrows--; arrowsEl.textContent = arrows;
  }

  // Game loop
  let last = performance.now();
  let paused = false;

  document.getElementById('pauseBtn').onclick = ()=>{ paused = !paused; };
  document.getElementById('resetBtn').onclick = ()=>{ arrows=0; score=0; hits=0; arrowsEl.textContent=0; scoreEl.textContent=0; hitsEl.textContent=0; projectiles.length=0; target.x = cvs.width - 140; target.y = 160; wind=0; windTarget=0; };

  function update(dt){
    // power charge
    if(bow.drawing){ bow.power = clamp(bow.power + dt*0.6, 0, 1); }

    // move target (bounces vertically)
    target.y += target.vy * target.dir * dt;
    if(target.y < 90){ target.y = 90; target.dir = 1; }
    if(target.y > cvs.height-160){ target.y = cvs.height-160; target.dir = -1; }

    updateWind(dt);

    // update arrows
    for(const a of projectiles){
      if(a.stuck) continue;
      a.life += dt;
      a.vy += 600*dt; // gravity
      a.vx += wind*dt; // wind push
      a.x += a.vx*dt; a.y += a.vy*dt;
      a.angle = Math.atan2(a.vy, a.vx);

      // hit test with target
      const dx = a.x - target.x;
      const dy = a.y - target.y;
      const dist = Math.hypot(dx, dy);
      if(dist < target.r){
        // scoring by ring
        const ring = dist / target.r; // 0 center .. 1 edge
        let pts = 10;
        if(ring < 0.2) pts = 50; // bullseye
        else if(ring < 0.4) pts = 30;
        else if(ring < 0.6) pts = 20;
        else if(ring < 0.8) pts = 15;
        addScore(pts);
        addHit();
        // stick arrow into target at impact
        a.stuck = true; a.vx = 0; a.vy = 0;
        // nudge target a bit for feedback
        target.x += rand(-6,6); target.y += rand(-4,4);
        showToast(`+${pts} pts`);
        // small chance to drop an arrow on bullseye
        if(pts >= 50){ addArrows(1); showToast(`Bullseye! +${pts} & +1 arrow`); }
      }

      // off-screen cleanup
      if(a.x>cvs.width+50 || a.y>cvs.height+50 || a.x<-50 || a.y<-50){ a.stuck=true; }
    }
  }

  function draw(){
    // background sky gradient already on canvas; draw ground
    const grd = ctx.createLinearGradient(0, cvs.height-140, 0, cvs.height);
    grd.addColorStop(0, '#0d1b33'); grd.addColorStop(1, '#0a1427');
    ctx.fillStyle = grd; ctx.fillRect(0, cvs.height-140, cvs.width, 140);

    // distant hills
    ctx.fillStyle = '#0d1730';
    ctx.beginPath(); ctx.moveTo(0,cvs.height-140);
    for(let x=0;x<=cvs.width;x+=40){
      const y = cvs.height-140 - 20*Math.sin(x*0.01) - 8*Math.cos(x*0.03);
      ctx.lineTo(x, y);
    }
    ctx.lineTo(cvs.width, cvs.height); ctx.lineTo(0,cvs.height); ctx.closePath(); ctx.fill();

    // wind indicator arrows
    ctx.save();
    ctx.globalAlpha = .25;
    const w = wind; const baseY = 42;
    for(let i=0;i<9;i++){
      const bx = 40 + i*28; const len = clamp(Math.abs(w)*1.6,0,28);
      ctx.strokeStyle = '#8fb5ff'; ctx.lineWidth = 2; ctx.beginPath();
      if(w>=0){ ctx.moveTo(bx, baseY); ctx.lineTo(bx+len, baseY); ctx.lineTo(bx+len-6, baseY-4); ctx.moveTo(bx+len, baseY); ctx.lineTo(bx+len-6, baseY+4); }
      else { ctx.moveTo(bx, baseY); ctx.lineTo(bx-len, baseY); ctx.lineTo(bx-len+6, baseY-4); ctx.moveTo(bx-len, baseY); ctx.lineTo(bx-len+6, baseY+4); }
      ctx.stroke();
    }
    ctx.restore();

    // target (concentric rings)
    ctx.save();
    ctx.translate(target.x, target.y);
    const rings = [ ['#ffffff',1.0], ['#e74c3c',0.8], ['#ffffff',0.6], ['#2ecc71',0.4], ['#f1c40f',0.2] ];
    for(const [color,f] of rings){ ctx.beginPath(); ctx.fillStyle = color; ctx.arc(0,0,target.r*f,0,Math.PI*2); ctx.fill(); }
    ctx.restore();

    // bow
    const dx = bow.aimX - bow.x; const dy = bow.aimY - bow.y; const ang = Math.atan2(dy, dx);
    ctx.save(); ctx.translate(bow.x, bow.y); ctx.rotate(ang);
    // bow body
    ctx.strokeStyle = '#d3b47f'; ctx.lineWidth = 6; ctx.beginPath();
    ctx.arc(-10,0,44,-Math.PI/2, Math.PI/2, true); ctx.stroke();
    // string
    ctx.strokeStyle = '#c5d5ff'; ctx.lineWidth = 2; ctx.beginPath();
    const pull = 10 + bow.power*30;
    ctx.moveTo(-10,-44); ctx.quadraticCurveTo(pull,0,-10,44); ctx.stroke();
    // arrow preview while drawing
    if(bow.drawing){
      ctx.fillStyle = '#b0ffd8'; ctx.fillRect(10,-2, 36,4);
      ctx.beginPath(); ctx.moveTo(46,0); ctx.lineTo(36,-6); ctx.lineTo(36,6); ctx.closePath(); ctx.fill();
    }
    ctx.restore();

    // projectiles
    for(const a of projectiles){
      ctx.save(); ctx.translate(a.x, a.y); ctx.rotate(a.angle);
      ctx.fillStyle = '#f8fafc'; ctx.fillRect(-12,-1.5, 24,3);
      ctx.fillStyle = '#9ae6b4'; ctx.beginPath(); ctx.moveTo(12,0); ctx.lineTo(3,-4); ctx.lineTo(3,4); ctx.closePath(); ctx.fill();
      ctx.fillStyle = '#9fb3c8'; ctx.fillRect(-16,-4, 6,8);
      ctx.restore();
    }

    // UI: power meter
    const pw = bow.power;
    ctx.fillStyle = '#0c142b'; ctx.fillRect(16, cvs.height-26, 160, 12);
    ctx.fillStyle = '#5ee1a2'; ctx.fillRect(16, cvs.height-26, 160*pw, 12);
    ctx.strokeStyle = '#233459'; ctx.strokeRect(16.5, cvs.height-26.5, 159, 11);

    // arrows indicator (mini icons)
    for(let i=0;i<arrows;i++){
      const ax = cvs.width - 18 - i*12; const ay = cvs.height - 22;
      ctx.fillStyle = '#f8fafc'; ctx.fillRect(ax-6, ay-1, 12,2);
      ctx.fillStyle = '#9ae6b4'; ctx.beginPath(); ctx.moveTo(ax+6,ay); ctx.lineTo(ax+2, ay-3); ctx.lineTo(ax+2, ay+3); ctx.closePath(); ctx.fill();
    }
  }

  function loop(now){
    const dt = Math.min(0.033, (now - last)/1000);
    last = now;
    if(!paused){ update(dt); }
    ctx.clearRect(0,0,cvs.width,cvs.height);
    draw();
    requestAnimationFrame(loop);
  }
  requestAnimationFrame(loop);

  </script>
</body>
</html>
