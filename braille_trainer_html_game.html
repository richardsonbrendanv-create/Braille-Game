<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Braille Trainer â€“ Learn & Quiz</title>
  <style>
    :root {
      --bg: #0b1020;
      --panel: #121a33;
      --ink: #e8ecf7;
      --muted: #a6b0cf;
      --accent: #6aa6ff;
      --good: #27d17f;
      --bad: #ff6a6a;
      --ring: rgba(106,166,255,.5);
    }
    [data-theme="light"] {
      --bg: #f8fafc;
      --panel: #ffffff;
      --ink: #0b1020;
      --muted: #465070;
      --accent: #275efe;
      --good: #0ca678;
      --bad: #e03131;
      --ring: rgba(39,94,254,.2);
    }
    html, body { height: 100%; }
    body {
      margin: 0; background: radial-gradient(1200px 800px at 20% -10%, #1a2347 0%, transparent 60%), var(--bg);
      color: var(--ink); font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Inter, "Helvetica Neue", Arial;
      line-height: 1.35; -webkit-font-smoothing: antialiased; -moz-osx-font-smoothing: grayscale;
    }
    .wrap { max-width: 1100px; margin: 0 auto; padding: 24px; }

    header {
      display: grid; grid-template-columns: 1fr auto auto; gap: 12px; align-items: center; margin-bottom: 16px;
    }
    .title { font-size: clamp(20px, 2.8vw, 32px); font-weight: 800; letter-spacing: .3px; }
    .sub { color: var(--muted); font-size: 14px; }
    .row { display: flex; gap: 10px; align-items: center; flex-wrap: wrap; }

    .card { background: linear-gradient(180deg, rgba(255,255,255,.02), rgba(0,0,0,.06)), var(--panel); border: 1px solid rgba(255,255,255,.06);
            border-radius: 16px; padding: 18px; box-shadow: 0 10px 30px rgba(0,0,0,.25); }

    .controls { display: grid; grid-template-columns: 1fr; gap: 12px; }
    @media (min-width: 860px) { .controls { grid-template-columns: 1fr auto; } }

    .seg {
      display: inline-flex; background: rgba(255,255,255,.06); border: 1px solid rgba(255,255,255,.08); padding: 4px; border-radius: 12px; gap: 4px;
    }
    .seg button { background: transparent; color: var(--ink); padding: 10px 12px; border: 0; border-radius: 10px; cursor: pointer; font-weight: 600; font-size: 14px; }
    .seg button[aria-pressed="true"], .seg button.active { background: var(--accent); color: #fff; box-shadow: 0 0 0 6px var(--ring); }

    .statbar { display: flex; gap: 10px; flex-wrap: wrap; justify-content: flex-end; }
    .stat { background: rgba(255,255,255,.06); border: 1px solid rgba(255,255,255,.08); padding: 8px 10px; border-radius: 10px; font-weight: 700; }

    .grid { display: grid; grid-template-columns: 1fr; gap: 16px; }
    @media (min-width: 860px) { .grid { grid-template-columns: 420px 1fr; align-items: start; } }

    .braille-board { display: grid; grid-template-columns: repeat(2, 70px); grid-template-rows: repeat(3, 70px); gap: 14px; justify-content: center; }
    .dot { width: 70px; height: 70px; border-radius: 50%; background: radial-gradient(35px 35px at 35% 35%, rgba(255,255,255,.18), rgba(0,0,0,.20)); display: grid; place-items: center; border: 1px solid rgba(255,255,255,.10);
           box-shadow: inset 0 -6px 12px rgba(0,0,0,.35), 0 16px 30px rgba(0,0,0,.20);
           transition: transform .08s ease, background .2s ease, box-shadow .2s ease, border-color .2s ease; cursor: pointer; position: relative; }
    .dot[data-active="true"] { background: radial-gradient(35px 35px at 35% 35%, #fff, #cdd7ff); box-shadow: inset 0 -6px 10px rgba(0,0,0,.15), 0 16px 30px rgba(39,94,254,.25); border-color: #cdd7ff; }
    .dot:focus-visible { outline: none; box-shadow: 0 0 0 6px var(--ring), inset 0 -6px 12px rgba(0,0,0,.35); }
    .dot .num { position: absolute; bottom: 6px; right: 10px; font-size: 12px; opacity: .65; color: var(--muted); }

    .prompt { font-size: 40px; font-weight: 900; letter-spacing: 1px; text-align: center; margin: 8px 0 2px; }
    .prompt small { display: block; font-size: 13px; color: var(--muted); font-weight: 600; margin-top: 6px; }

    .answer-row { display: grid; grid-template-columns: 1fr auto; gap: 12px; align-items: center; }
    .answer-row input[type="text"] { background: var(--panel); border: 1px solid rgba(255,255,255,.12); color: var(--ink); padding: 12px 14px; border-radius: 10px; font-size: 18px; font-weight: 700; }
    .answer-row button,.btn { background: var(--accent); color: white; border: 0; border-radius: 10px; padding: 12px 14px; font-weight: 800; cursor: pointer; }
    .btn.secondary { background: rgba(255,255,255,.08); color: var(--ink); border: 1px solid rgba(255,255,255,.12); }

    .feedback { min-height: 28px; font-weight: 800; text-align: center; }
    .ok { color: var(--good); }
    .no { color: var(--bad); }

    .key { display: grid; grid-template-columns: repeat(auto-fill, minmax(140px, 1fr)); gap: 10px; }
    .key .cell { display: grid; gap: 8px; justify-items: center; padding: 10px; border-radius: 12px; background: rgba(255,255,255,.04); border: 1px solid rgba(255,255,255,.08); }
    .kbd { display: inline-grid; grid-auto-flow: column; gap: 6px; background: rgba(255,255,255,.06); padding: 4px 8px; border-radius: 8px; border: 1px solid rgba(255,255,255,.08); font-size: 12px; }

    dialog { background: var(--panel); color: var(--ink); border: 1px solid rgba(255,255,255,.12); border-radius: 16px; width: min(860px, 92vw); padding: 18px 18px 22px; }
    dialog::backdrop { background: rgba(3,7,18,.55); backdrop-filter: blur(2px); }

    .tiny { font-size: 12px; color: var(--muted); }
    .muted { color: var(--muted); }
    .sr-only { position: absolute; width: 1px; height: 1px; padding: 0; margin: -1px; overflow: hidden; clip: rect(0,0,0,0); white-space: nowrap; border: 0; }
  </style>
</head>
<body>
  <div class="wrap" id="app" data-theme="dark">
    <header>
      <div>
        <div class="title">Braille Trainer <span class="muted">â€” learn, practice, master</span></div>
        <div class="sub">Six dots. Endless possibilities. Keyboard friendly, screenâ€‘reader aware, and fast.</div>
      </div>
      <div class="row">
        <div class="seg" role="tablist" aria-label="Game modes">
          <button role="tab" id="mode-dots2letter" aria-selected="true" class="active">Dots â†’ Letter</button>
          <button role="tab" id="mode-letter2dots">Letter â†’ Dots</button>
        </div>
        <button id="speak" class="btn secondary" title="Speak prompt" aria-label="Speak prompt">ðŸ”ˆ Speak</button>
        <button id="toggle-theme" class="btn secondary" title="Toggle theme" aria-label="Toggle theme">ðŸŒ— Theme</button>
        <button id="open-key" class="btn secondary" title="Open Braille key" aria-label="Open Braille key">ðŸ“– Key</button>
      </div>
      <div class="statbar">
        <div class="stat">Score: <span id="score">0</span></div>
        <div class="stat">Streak: <span id="streak">0</span></div>
        <div class="stat">Best: <span id="best">0</span></div>
      </div>
    </header>

    <main class="grid">
      <section class="card" aria-labelledby="prompt-label">
        <div id="prompt" class="prompt" aria-live="polite" aria-atomic="true"></div>
        <div id="board" class="braille-board" aria-label="Braille cell" role="group"></div>
        <p class="tiny" style="text-align:center;margin:10px 0 2px;">Tip: In interactive mode, press keys <span class="kbd"><span>1</span><span>2</span><span>3</span><span>4</span><span>5</span><span>6</span></span> to toggle dots. <span class="kbd">Enter</span> to check. <span class="kbd">C</span> to clear.</p>
      </section>

      <section class="card controls">
        <!-- Dots â†’ Letter controls -->
        <div id="dots2letter-controls">
          <div class="answer-row">
            <input id="answer" type="text" inputmode="latin" autocomplete="off" placeholder="Type the letterâ€¦" aria-label="Type the letter" maxlength="1" />
            <button id="submit-answer" class="btn">Check</button>
          </div>
          <div class="row">
            <button id="skip" class="btn secondary">Skip â†»</button>
            <button id="reveal" class="btn secondary">Reveal</button>
          </div>
          <div class="feedback" id="feedback"></div>
        </div>

        <!-- Letter â†’ Dots controls -->
        <div id="letter2dots-controls" hidden>
          <div class="row">
            <button id="check-dots" class="btn">Check</button>
            <button id="clear-dots" class="btn secondary">Clear</button>
            <button id="new-letter" class="btn secondary">New</button>
          </div>
          <div class="feedback" id="feedback2"></div>
        </div>

        <div class="row" style="justify-content: space-between;">
          <div class="tiny">Practice set: <span id="practice-hint" class="muted">All letters Aâ€“Z</span></div>
          <div class="tiny">Mastered letters: <span id="mastered" class="muted">â€“</span></div>
        </div>
      </section>
    </main>

    <section class="card" style="margin-top:16px;">
      <details>
        <summary style="cursor:pointer;font-weight:800;">How to read the dots</summary>
        <div class="muted" style="margin-top:8px;">Dots are numbered:
          <pre style="background: rgba(255,255,255,.05); padding: 10px; border-radius: 10px; display: inline-block;">1 4\n2 5\n3 6</pre>
          Aâ€“J use top four dots only; Kâ€“T = Aâ€“J plus dot 3; Uâ€“Z = Aâ€“E plus dots 3 & 6 (except W).</div>
      </details>
    </section>

    <dialog id="keyDialog">
      <header class="row" style="justify-content: space-between;">
        <div class="title" style="font-size:22px;">Braille Alphabet Key</div>
        <button id="close-key" class="btn secondary">Close</button>
      </header>
      <div class="key" id="keyGrid" aria-label="Braille key"></div>
      <p class="tiny" style="margin-top:10px;">Source: standard literary (uncontracted) Braille. W is the only outlier historically.</p>
    </dialog>

  </div>

  <script>
    // --- Data ---
    const BRAILLE = {
      A: [1], B: [1,2], C: [1,4], D: [1,4,5], E: [1,5], F: [1,2,4], G: [1,2,4,5], H: [1,2,5], I: [2,4], J: [2,4,5],
      K: [1,3], L: [1,2,3], M: [1,3,4], N: [1,3,4,5], O: [1,3,5], P: [1,2,3,4], Q: [1,2,3,4,5], R: [1,2,3,5], S: [2,3,4], T: [2,3,4,5],
      U: [1,3,6], V: [1,2,3,6], W: [2,4,5,6], X: [1,3,4,6], Y: [1,3,4,5,6], Z: [1,3,5,6]
    };
    const LETTERS = Object.keys(BRAILLE);

    // --- State ---
    const state = {
      mode: 'dots2letter', // 'dots2letter' | 'letter2dots'
      currentLetter: null,
      interactive: false,
      score: 0,
      streak: 0,
      best: Number(localStorage.getItem('braille.best')||0),
      mastered: JSON.parse(localStorage.getItem('braille.mastered')||'{}'), // {A: count}
    };

    // --- DOM ---
    const app = document.getElementById('app');
    const promptEl = document.getElementById('prompt');
    const boardEl = document.getElementById('board');

    const dots2letterControls = document.getElementById('dots2letter-controls');
    const letter2dotsControls = document.getElementById('letter2dots-controls');

    const answerInput = document.getElementById('answer');
    const submitBtn = document.getElementById('submit-answer');
    const skipBtn = document.getElementById('skip');
    const revealBtn = document.getElementById('reveal');
    const feedback = document.getElementById('feedback');

    const checkDotsBtn = document.getElementById('check-dots');
    const clearDotsBtn = document.getElementById('clear-dots');
    const newLetterBtn = document.getElementById('new-letter');
    const feedback2 = document.getElementById('feedback2');

    const scoreEl = document.getElementById('score');
    const streakEl = document.getElementById('streak');
    const bestEl = document.getElementById('best');
    const masteredEl = document.getElementById('mastered');

    const modeDots2LetterBtn = document.getElementById('mode-dots2letter');
    const modeLetter2DotsBtn = document.getElementById('mode-letter2dots');

    const speakBtn = document.getElementById('speak');
    const themeBtn = document.getElementById('toggle-theme');

    // Key dialog
    const keyDialog = document.getElementById('keyDialog');
    const openKeyBtn = document.getElementById('open-key');
    const closeKeyBtn = document.getElementById('close-key');
    const keyGrid = document.getElementById('keyGrid');

    // --- Utils ---
    const shuffle = arr => arr.sort(() => Math.random() - 0.5);
    const eqDots = (a,b) => {
      if (!a || !b) return false;
      if (a.length !== b.length) return false;
      const as = [...a].sort((x,y)=>x-y), bs = [...b].sort((x,y)=>x-y);
      return as.every((v,i)=>v===bs[i]);
    }

    function speak(text){
      try {
        const synth = window.speechSynthesis;
        if (!synth) return;
        const u = new SpeechSynthesisUtterance(text);
        u.rate = 1.05; u.pitch = 1.0; u.lang = 'en-US';
        synth.cancel(); synth.speak(u);
      } catch(_){}
    }

    function updateStats(deltaScore=0, correct=false){
      state.score = Math.max(0, state.score + deltaScore);
      if (correct) state.streak++; else state.streak = 0;
      scoreEl.textContent = state.score;
      streakEl.textContent = state.streak;
      if (state.score > state.best){ state.best = state.score; localStorage.setItem('braille.best', state.best); }
      bestEl.textContent = state.best;
      // mastered list
      const masteredList = Object.entries(state.mastered).filter(([,c])=>c>=3).map(([L])=>L).sort().join(' ');
      masteredEl.textContent = masteredList || 'â€“';
    }

    function markMastered(letter, correct){
      const L = letter.toUpperCase();
      const cur = state.mastered[L] || 0;
      state.mastered[L] = Math.max(0, cur + (correct? 1 : -1));
      localStorage.setItem('braille.mastered', JSON.stringify(state.mastered));
    }

    // --- Braille board rendering ---
    function renderBoard(activeDots=[], interactive=false){
      boardEl.innerHTML = '';
      boardEl.setAttribute('data-interactive', interactive? 'true':'false');
      const positions = [1,2,3,4,5,6];
      positions.forEach(dotNum => {
        const btn = document.createElement('button');
        btn.className = 'dot';
        btn.type = 'button';
        btn.setAttribute('aria-pressed', activeDots.includes(dotNum));
        btn.dataset.active = activeDots.includes(dotNum)? 'true':'false';
        btn.dataset.dot = String(dotNum);
        btn.title = `Dot ${dotNum}`;
        btn.innerHTML = `<span class="num">${dotNum}</span>`;
        if (!interactive){ btn.tabIndex = -1; btn.setAttribute('aria-disabled','true'); }
        boardEl.appendChild(btn);
      });
      // Grid order mapping: 1 4 / 2 5 / 3 6
      boardEl.children[0].style.gridArea = '1 / 1';
      boardEl.children[1].style.gridArea = '2 / 1';
      boardEl.children[2].style.gridArea = '3 / 1';
      boardEl.children[3].style.gridArea = '1 / 2';
      boardEl.children[4].style.gridArea = '2 / 2';
      boardEl.children[5].style.gridArea = '3 / 2';

      if (interactive){
        boardEl.querySelectorAll('.dot').forEach(btn=>{
          btn.addEventListener('click', ()=>{
            const on = btn.dataset.active === 'true';
            btn.dataset.active = on? 'false':'true';
            btn.setAttribute('aria-pressed', !on);
          });
        });
      }
    }

    function getBoardDots(){
      return [...boardEl.querySelectorAll('.dot')]
        .filter(btn=>btn.dataset.active==='true')
        .map(btn=>Number(btn.dataset.dot))
        .sort((a,b)=>a-b);
    }

    function setBoardDots(dots){
      [...boardEl.querySelectorAll('.dot')].forEach(btn=>{
        const on = dots.includes(Number(btn.dataset.dot));
        btn.dataset.active = on? 'true':'false';
        btn.setAttribute('aria-pressed', on);
      });
    }

    function clearBoard(){ setBoardDots([]); }

    // --- Modes ---
    function pickRandomLetter(){
      const pool = LETTERS; // could later filter
      return pool[Math.floor(Math.random()*pool.length)];
    }

    function startDots2Letter(){
      state.mode = 'dots2letter';
      modeDots2LetterBtn.classList.add('active');
      modeDots2LetterBtn.setAttribute('aria-selected','true');
      modeLetter2DotsBtn.classList.remove('active');
      modeLetter2DotsBtn.setAttribute('aria-selected','false');
      dots2letterControls.hidden = false;
      letter2dotsControls.hidden = true;
      state.currentLetter = pickRandomLetter();
      promptEl.innerHTML = `<span id="prompt-label">What letter is this?</span><small>Answer with a single letter (Aâ€“Z).</small>`;
      renderBoard(BRAILLE[state.currentLetter], false);
      answerInput.value = '';
      answerInput.focus();
      feedback.textContent = '';
    }

    function startLetter2Dots(){
      state.mode = 'letter2dots';
      modeLetter2DotsBtn.classList.add('active');
      modeLetter2DotsBtn.setAttribute('aria-selected','true');
      modeDots2LetterBtn.classList.remove('active');
      modeDots2LetterBtn.setAttribute('aria-selected','false');
      dots2letterControls.hidden = true;
      letter2dotsControls.hidden = false;
      state.currentLetter = pickRandomLetter();
      promptEl.innerHTML = `<span id="prompt-label">Build this letter in dots:</span> <span style="font-size:56px; font-weight:900; letter-spacing:2px;">${state.currentLetter}</span>`;
      renderBoard([], true);
      feedback2.textContent = '';
    }

    function newQuestion(){
      if (state.mode==='dots2letter') startDots2Letter();
      else startLetter2Dots();
    }

    // --- Events: Dots â†’ Letter ---
    submitBtn.addEventListener('click', ()=>{
      const raw = answerInput.value.trim();
      if (!raw) return;
      const guess = raw.toUpperCase();
      const correct = guess === state.currentLetter;
      if (correct){
        feedback.innerHTML = `<span class="ok">âœ“ Correct!</span> ${state.currentLetter} = dots ${BRAILLE[state.currentLetter].join('-')}`;
        updateStats(+10, true);
        markMastered(state.currentLetter, true);
        setTimeout(newQuestion, 500);
      } else {
        feedback.innerHTML = `<span class="no">âœ— Not quite.</span> Try again.`;
        updateStats(-2, false);
        markMastered(state.currentLetter, false);
      }
    });

    answerInput.addEventListener('keydown', (e)=>{
      if (e.key==='Enter'){ submitBtn.click(); }
    });

    skipBtn.addEventListener('click', ()=>{ updateStats(-1,false); newQuestion(); });
    revealBtn.addEventListener('click', ()=>{
      feedback.innerHTML = `It was <strong>${state.currentLetter}</strong> (dots ${BRAILLE[state.currentLetter].join('-')}).`;
      updateStats(-3,false);
      setTimeout(newQuestion, 650);
    });

    // --- Events: Letter â†’ Dots ---
    checkDotsBtn.addEventListener('click', ()=>{
      const dots = getBoardDots();
      const target = BRAILLE[state.currentLetter];
      const ok = eqDots(dots, target);
      if (ok){
        feedback2.innerHTML = `<span class="ok">âœ“ Correct!</span> ${state.currentLetter} = dots ${target.join('-')}`;
        updateStats(+12, true);
        markMastered(state.currentLetter, true);
        setTimeout(newQuestion, 600);
      } else {
        feedback2.innerHTML = `<span class="no">âœ— Not yet.</span> You're showing ${dots.join('-')||'none'} but need ${target.join('-')}.`;
        updateStats(-2, false);
        markMastered(state.currentLetter, false);
      }
    });
    clearDotsBtn.addEventListener('click', clearBoard);
    newLetterBtn.addEventListener('click', ()=>{ updateStats(-1,false); newQuestion(); });

    // Keyboard for interactive board
    window.addEventListener('keydown', (e)=>{
      if (state.mode !== 'letter2dots') return;
      if (/^[1-6]$/.test(e.key)){
        const btn = boardEl.querySelector(`.dot[data-dot="${e.key}"]`);
        if (btn){ btn.click(); e.preventDefault(); }
      } else if (e.key==='Enter'){ checkDotsBtn.click(); } else if (e.key.toLowerCase()==='c'){ clearDotsBtn.click(); }
    });

    // Mode toggles
    modeDots2LetterBtn.addEventListener('click', startDots2Letter);
    modeLetter2DotsBtn.addEventListener('click', startLetter2Dots);

    // Theme
    themeBtn.addEventListener('click', ()=>{
      const isDark = app.getAttribute('data-theme') !== 'light';
      app.setAttribute('data-theme', isDark? 'light':'dark');
      localStorage.setItem('braille.theme', isDark? 'light':'dark');
    });
    // restore theme
    const savedTheme = localStorage.getItem('braille.theme');
    if (savedTheme) app.setAttribute('data-theme', savedTheme);

    // Speech
    speakBtn.addEventListener('click', ()=>{
      if (state.mode==='dots2letter') speak('What letter is this?');
      else speak(`Build the letter ${state.currentLetter}`);
    });

    // Key dialog
    openKeyBtn.addEventListener('click', ()=> keyDialog.showModal());
    closeKeyBtn.addEventListener('click', ()=> keyDialog.close());

    function renderKey(){
      keyGrid.innerHTML = '';
      LETTERS.forEach(L=>{
        const cell = document.createElement('div');
        cell.className = 'cell';
        const title = document.createElement('div');
        title.innerHTML = `<strong style="font-size:18px;">${L}</strong>`;
        const mini = document.createElement('div');
        mini.className = 'braille-board';
        mini.style.gridTemplateColumns = 'repeat(2, 28px)';
        mini.style.gridTemplateRows = 'repeat(3, 28px)';
        mini.style.gap = '6px';
        // create tiny dots
        for (let i=1;i<=6;i++){
          const d = document.createElement('div');
          d.className = 'dot';
          d.style.width='28px'; d.style.height='28px'; d.style.cursor='default';
          d.dataset.active = BRAILLE[L].includes(i)? 'true':'false';
          d.setAttribute('aria-pressed', d.dataset.active==='true');
          d.innerHTML = `<span class="num" style="display:none"></span>`;
          d.style.boxShadow = 'inset 0 -4px 8px rgba(0,0,0,.35)';
          mini.appendChild(d);
        }
        // grid areas
        mini.children[0].style.gridArea = '1 / 1';
        mini.children[1].style.gridArea = '2 / 1';
        mini.children[2].style.gridArea = '3 / 1';
        mini.children[3].style.gridArea = '1 / 2';
        mini.children[4].style.gridArea = '2 / 2';
        mini.children[5].style.gridArea = '3 / 2';

        const dots = document.createElement('div');
        dots.className = 'tiny';
        dots.textContent = 'dots ' + BRAILLE[L].join('-');

        cell.appendChild(title);
        cell.appendChild(mini);
        cell.appendChild(dots);
        keyGrid.appendChild(cell);
      });
    }

    // Init
    renderKey();
    updateStats(0,false);
    startDots2Letter();

  </script>
</body>
</html>
